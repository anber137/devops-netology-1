# Домашнее задание к занятию "7.3. Основы и принцип работы Терраформ"

## Задача 1. Создадим бэкэнд в S3 (необязательно, но крайне желательно).

<details><summary>.</summary>

> Если в рамках предыдущего задания у вас уже есть аккаунт AWS, то давайте продолжим знакомство со взаимодействием терраформа и aws. 
> 
> 1. Создайте s3 бакет, iam роль и пользователя от которого будет работать терраформ. Можно создать отдельного пользователя, а можно использовать созданного в рамках предыдущего задания, просто добавьте ему необходимы права, как описано [здесь](https://www.terraform.io/docs/backends/types/s3.html).
> 1. Зарегистрируйте бэкэнд в терраформ проекте как описано по ссылке выше. 

</details>

`Конфиг Terraform`
```bash
$ cat s3.tf
terraform {
  backend "s3" {
    bucket = "netology-73"
    key    = "devops-netology/virt-11/73/terraform.tfstate"
    region = "eu-north-1"
  }
}
```
`Вывод aws cli для s3 после terraform apply`
```bash
$ aws s3 ls netology-73 --recursive
2022-01-16 23:12:25       8787 devops-netology/virt-11/73/terraform.tfstate
```

## Задача 2. Инициализируем проект и создаем воркспейсы. 

<details><summary>.</summary>

> 1. Выполните `terraform init`:
>     * если был создан бэкэнд в S3, то терраформ создат файл стейтов в S3 и запись в таблице dynamodb.
>     * иначе будет создан локальный файл со стейтами.  
> 1. Создайте два воркспейса `stage` и `prod`.
> 1. В уже созданный `aws_instance` добавьте зависимость типа инстанса от вокспейса, что бы в разных ворскспейсах использовались разные `instance_type`.
> 1. Добавим `count`. Для `stage` должен создаться один экземпляр `ec2`, а для `prod` два. 
> 1. Создайте рядом еще один `aws_instance`, но теперь определите их количество при помощи `for_each`, а не `count`.
> 1. Что бы при изменении типа инстанса не возникло ситуации, когда не будет ни одного инстанса добавьте параметр жизненного цикла `create_before_destroy = true` в один из рессурсов `aws_instance`.
> 1. При желании поэкспериментируйте с другими параметрами и рессурсами.
> 
> В виде результата работы пришлите:
> * Вывод команды `terraform workspace list`.
> * Вывод команды `terraform plan` для воркспейса `prod`.  

</details>

### Вывод команды `terraform workspace list`.

### Вывод команды `terraform plan` для воркспейса `prod`.  
